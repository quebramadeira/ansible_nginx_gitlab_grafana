---
  - name: Install required packages
    yum:
      name:
        - wget
        - curl
        - initscripts
      state: present
      
  - name: Add Grafana Repository
    lineinfile:
      path: /etc/yum.repos.d/grafana.repo
      line: |
        [grafana]
        name=grafana
        baseurl= "{{ baseurl }}"
        repo_gpgcheck=1
        enabled=1
        gpgcheck=1
        gpgkey= "{{ gpgkey }}"
        sslverify=1
        sslcacert=/etc/pki/tls/certs/ca-bundle.crt
        exclude=*beta*
      create: yes
      state: present
     
  - set_fact: grafana_release='grafana={{grafana_version}}'   

  - name: Install Grafana
    yum: name="{{grafana_release}}"
    state: present
    when: grafana_version != "latest"
      
    #shell: yum install grafana-{{ grafana_version }} -y
    #become: yes   
      
  - name: Install Grafana Latest
    yum: name= grafana
    when: grafana_version == "latest"
    state: present

  - name: Start Grafana Service
    service:
      name: grafana-server
      state: started
      enabled: yes
