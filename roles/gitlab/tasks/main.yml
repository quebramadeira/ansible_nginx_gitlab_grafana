  - name: Install required packages
    yum:
      name: "{{ gitlab_dependencies }}"
      state: present
      
  - name: Enable Postfix service
    become: yes
    service:
      name: postfix 
      enabled: yes
      state: started
    notify: restart_postfix 
      
  - name: Add GitLab Repository
    shell: curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash
    become: yes
    
  - set_fact: gitlab_release='gitlab-ce-{{gitlab_version}}'     
    
  - name: Install GitLab
    yum:
      name: "{{gitlab_release}}"
      state: present
   # notify:  
   #   - restart gitlab
 
  - name: Open Firewall Ports 
    become: yes
    firewalld: 
      permanent: true
      service: "{{ item }}"
      state: enabled
      immediate: yes
    with_items:
      - http
      - https
  - name: Configure GitLab URL
    lineinfile:
      path: /etc/gitlab/gitlab.rb
      line: |
        external_url "https://{{ gitlab_url }}"
      state: present
    notify: 
    - restart gitlab 
      
